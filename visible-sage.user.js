// ==UserScript==
// @name        Visible Sage
// @namespace   4chan.org
// @description Not a downvote
// @include     /^https?://boards\.4chan\.org/.*$/
// @version     1.1
// @grant       none
// @run-at      document-start
// @downloadURL https://raw.githubusercontent.com/visiblesage/visible-sage/master/visible-sage.user.js
// @require     https://raw.githubusercontent.com/uzairfarooq/arrive/master/minified/arrive.min.js
// @icon        data:image/png;base64,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
// ==/UserScript==

// Javascript can't handle unicode above 0xFFFF natively...
function fixedFromCharCode (codePt) {
    if (codePt > 0xFFFF) {
        codePt -= 0x10000;
        return String.fromCharCode(0xD800 + (codePt >> 10), 0xDC00 + (codePt & 0x3FF));
    }
    else {
        return String.fromCharCode(codePt);
    }
}

// Sage is still invisible, so we mark saged posts with a rare unicode space at the end.
// This means only people who use this extension will see each other's sage,
// but there's no better way this since sage is otherwise entirely invisible.
var magic = fixedFromCharCode(0x1BCA0);

showSage = function(post) {
  if (!post.innerText.endsWith(magic))
    return;
  var len = $.qsa("#pi"+post.id.substr(1)+" .nameBlock").length;
  for (var i=0; i<len; ++i) {
    var mail = document.createElement('a');
    mail.href = "mailto:sage";
    mail.className = "useremail";
    mail.appendChild($.qsa("#pi"+post.id.substr(1)+" .nameBlock")[0]);
    mail.style.marginRight = '5px';
    var parent = $.qsa("#pi"+post.id.substr(1))[i];
    parent.insertBefore(mail, parent.children[1]);
  }
}

function sageifyOriginal() {
  var originalSubmit = $.qs('#postForm input[type="submit"]');
  if (originalSubmit !== null) {
    originalSubmit.addEventListener('click', function(){
      if ($.qs('#postForm input[name="email"]').value.endsWith('sage'))
        $.qs('#postForm textarea[name="com"]').value += magic;
    }, true);
  }
}

function sageifyOriginalQR() {
  document.arrive("#quickReply", function() {
    var submitButton = $.qs('#quickReply input[type="submit"]');
    if (submitButton !== null) {
      submitButton.addEventListener('click', function(){
        if ($.qs('#qrEmail').value.endsWith('sage'))
          $.qs('#quickReply textarea[name="com"]').value += magic;
      }, true);
    }
  });
}

function sageify4chanX() {
  document.arrive("#qr", function() {
    var submitButton = $.qsa('#qr form input[type="submit"]');
    if (submitButton.length == 1) {
      submitButton[0].addEventListener('click', function(){
        if ($.qsa('#qr form input[name="email"]')[0].value.endsWith('sage'))
          $.qsa("#qr .textarea .field")[0].value += magic;
      }, true);
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  sageifyOriginal();
  sageifyOriginalQR();
  sageify4chanX();
  
  document.arrive(".postContainer .postMessage", function() {
    showSage(this);
  });
  
  for (var post of $.qsa('.postContainer .postMessage')) {
    showSage(post);
  }
});
